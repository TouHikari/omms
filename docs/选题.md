# 在线医疗管理系统

## 技术栈

### 后端技术栈

| 技术/框架       | 版本  | 用途     | 选型理由                                           |
| --------------- | ----- | -------- | -------------------------------------------------- |
| Java            | 17    | 开发语言 | 成熟稳定，适合企业级应用开发                       |
| Spring Boot     | 3.2.x | 应用框架 | 简化开发，提供丰富的开箱即用功能                   |
| Spring Security | 6.x   | 安全框架 | 强大的认证授权机制，适合医疗系统的高安全性要求     |
| Spring Data JPA | 3.x   | ORM 框架 | 简化数据库操作，提高开发效率（替代原 JPA+MyBatis） |
| MyBatis         | 3.5.x | ORM 框架 | 灵活的 SQL 控制，适合复杂查询场景                  |
| JWT             | -     | 认证机制 | 无状态认证，便于系统扩展                           |
| MySQL           | 8.0   | 主数据库 | 成熟稳定的关系型数据库，适合医疗数据的结构化存储   |

### 前端技术栈

| 技术/框架      | 版本 | 用途        | 选型理由                             |
| -------------- | ---- | ----------- | ------------------------------------ |
| Vue 3          | 3.x  | 前端框架    | 组合式 API，生态完善，易维护         |
| Ant Design Vue | 4.x  | UI 组件库   | 企业级设计体系，组件完善，适配 Vue 3 |
| Vue Router     | 4.x  | 路由管理    | 单页应用路由与动态路由支持           |
| Axios          | 1.x  | HTTP 客户端 | 处理前后端 API 交互                  |
| Day.js         | 1.x  | 日期处理    | 轻量高效的日期时间处理库             |
| ECharts        | 5.x  | 图表库      | 强大可视化能力，支持多种统计图表     |

## 基本功能

1. 用户管理

- 用户角色分配：患者、医生、护士、管理员。
- 用户注册与登录，支持邮箱或手机号验证。
- 权限分配：
- 患者：查看病历、预约医生、支付费用。
- 医生：查看患者病历、填写诊断信息、管理预约。
- 护士：管理病房信息、安排住院患者、处理检查请求。
- 管理员：管理用户、系统配置、生成统计报表。

2. 预约管理

- 医生排班：管理员为医生设置工作日与可预约时间段。
- 在线预约：患者选择科室和医生，提交预约申请，系统确认空闲时间后生成预约单。
- 预约提醒：通过短信或邮件提醒患者预约时间。
- 预约状态跟踪：支持查看预约状态（待就诊、已完成、已取消等）。

3. 病历管理

- 患者病历信息管理：记录患者病史、检查报告、诊断结果、处方药品等信息。
- 病历查询：医生可按患者姓名、ID、就诊日期查询病历。
- 病历共享：支持患者授权医生或医院查看病历。

4. 住院管理

- 病房分配：护士根据患者需求分配病房（普通病房、VIP 病房等）。
- 住院记录：记录住院患者的治疗方案、每日护理记录等。
- 出院管理：记录出院时间及费用结算。

5. 药品与库存管理

- 药品信息管理：添加、编辑、删除药品信息（名称、批次、库存、有效期）。
- 药品库存监控：设置库存上下限，库存不足时自动提醒管理员补货。
- 医生开药：医生填写处方，护士或药剂师审核后发药。

6. 在线支付

- 费用清单生成：根据诊疗项目、药品费用等生成费用清单。
- 在线支付：患者通过系统支付挂号费、诊疗费、住院费等。
- 支付记录：记录每笔支付的详细信息，支持导出为 PDF。

7. 检查与检验管理

- 检查申请：医生为患者开具检查申请单，护士或检验科处理。
- 检验结果上传：检验科上传检查报告，医生和患者可在线查看。
- 检查历史：支持按患者查询过往所有检查记录。

8. 报表与统计

- 就诊统计：统计每日、每月就诊人数，按科室或医生分类。
- 收入统计：统计诊疗收入、药品销售收入等数据。
- 药品使用统计：统计药品消耗情况，支持报表导出。
- 患者统计：按疾病类型、性别、年龄等分类分析患者数据。

9. 通知与消息中心

- 系统通知：管理员发布通知，支持按角色或全体推送。
- 预约提醒：向患者发送预约提醒和就诊指引。
- 检查结果通知：检查结果完成后系统自动通知患者查看。

10. 系统安全与日志

- 数据安全存储：对病历、支付信息等敏感数据加密存储。
- 操作日志：记录所有操作，包括预约、开药、支付等关键行为。
- 数据备份与恢复：支持定期备份，确保医疗数据安全。

## 版本规划

- 迭代方式：双周迭代；周一需求评审与任务拆分，周五演示与验收；每日站会与看板跟踪。
- 版本分支：`main`（稳定发布）、`dev`（迭代开发）。

## 非功能需求目标

- 性能与容量：单实例 QPS≥200；P95 响应 < 400ms；并发在线用户 500；日预约量 5,000。
- 可用性：工作时段 SLA≥99.5%；RTO≤2 小时；RPO≤24 小时。
- 扩展性：预约与支付接口支持水平扩展；缓存用于热数据（医生排班、科室信息）。
- 可靠性：对外接口重试与幂等；关键流程（预约、支付）支持降级与告警。

## 安全与合规

- 数据分类：PII（姓名、联系方式）、医疗敏感（病历、处方）、交易数据（订单、支付）。
- 加密：传输层 TLS1.2+；静态加密字段（病历要点、支付标识）；密码哈希使用 BCrypt。
- 认证：JWT 访问令牌（短期有效）+ 刷新令牌；设备/IP 基础风控（频控与黑名单）。
- 授权：RBAC + 作用域控制（按科室/医生）；行级访问限制（医生仅访问所属患者）。
- 审计：预约、处方、支付、库存关键操作记录；日志留存策略（审计 ≥180 天）。
- 合规：最小必要原则、日志脱敏、数据留存与删除策略，符合个人信息保护相关要求。

## 权限与数据治理

- 角色矩阵（概要）：
- 患者：查看个人病历与检查结果、预约、支付。
- 医生：查看名下患者病历、开具处方、管理预约。
- 护士：病区内病房与住院登记、执行医嘱、检查申请处理。
- 管理员：用户与角色管理、系统配置、报表与全局审计。
- 数据隔离：医生按科室/患者绑定访问；护士按病区隔离；管理员为受控全局访问。
- 审批策略：处方审核可配置（MVP 阶段可暂缓至管理员抽检）。

## 数据模型与编号规则（概要）

- 核心实体：用户、角色、科室、医生排班、预约、病历、处方、药品、库存批次、支付订单、检验单、检查报告。
- 编号规则：
- 预约号：`R-YYYYMMDD-序号`。
- 处方号：`RX-YYYYMMDD-序号`。
- 检验单号：`LAB-YYYYMMDD-序号`。
- 枚举：预约状态（待就诊/已完成/已取消）、支付状态（待支付/已支付/已退款）。

## API 规范（v1）

- 路径前缀：`/api/v1`；统一响应格式：`{ code, message, data }`；错误码分段（业务 4xx、权限 403、系统 5xx）。
- 认证与授权：`Authorization: Bearer <jwt>`；每个接口校验角色与作用域。
- 幂等与重试：预约提交携带 `Idempotency-Key`；支付回调校验签名并幂等更新。
- 分页与过滤：`page,size,sort`；统一筛选参数命名与时间范围。

## 业务流程（概要）

- 预约流程：选择科室/医生 → 冲突检测 → 时间段锁定 → 确认生成预约 → 提醒通知。
- 就诊与病历：医生查看预约 → 录入病历与处方 → 患者确认。
- 检查/检验：医生申请 → 检验科处理 → 结果上传 → 患者与医生可查看 → 消息通知。
- 药品与库存：处方生成 → 审核/发药 → 库存批次扣减 → 低库存与效期预警。

## 支付与对账

- 支付通道：微信/支付宝沙箱；订单创建、回调通知、签名校验；状态轮询容错。
- 对账：每日对账报表；异常订单（未回调/金额不符）处理流程与告警。
- 退款策略：MVP 仅支持就诊前的全额退款；就诊后退款与部分退款后续规划。

## 报表与统计口径

- 指标：就诊人数（日/月、按科室/医生）、收入（诊疗/药品）、药品消耗。
- 口径定义：明确去重规则与时间归属（按就诊完成时间）。
- 刷新策略：小时级增量统计；导出格式 CSV/PDF（MVP 可先 CSV）。

## 运维与部署

- 环境：`dev/test/prod`；MVP 阶段单机部署（后端+MySQL）。
- CI/CD：代码合并触发构建与测试。
- 监控与告警：接口耗时、错误率、队列堆积（如使用）；阈值告警与日报。
- 日志策略：应用日志保留 ≥30 天；审计日志 ≥180 天；敏感字段脱敏。

## 备份与灾备

- 数据库：每日全备，保留 7 天；每周合成备份；跨机房（或云存储）外置备份。
- 演练：季度恢复演练；恢复时间目标（RTO≤2 小时）。

## 测试计划

- 覆盖目标：单元测试覆盖率 ≥60%；关键流程 E2E 用例 ≥8 条（预约、就诊、处方、支付、对账）。
- 测试类型：单元/集成/E2E/UAT；测试数据脱敏与构造规范。
- 发布准入：关键缺陷清零；性能基线达标；回归测试通过。

## 其他

在此基础上，可以对此文档进行扩展。
