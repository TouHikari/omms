# 在线医疗系统数据库结构设计文档

## 1. 数据库概述

- 数据库名称：medical_system
- 字符集：utf8mb4
- 排序规则：utf8mb4_unicode_ci
- 存储引擎：InnoDB

## 2. 表结构设计

### 2.1 用户管理相关表

#### 2.1.1 用户表（users）

| 字段名 | 数据类型 | 约束 | 描述 |
|-------|---------|------|------|
| user_id | BIGINT | PRIMARY KEY, AUTO_INCREMENT | 用户ID |
| username | VARCHAR(50) | NOT NULL, UNIQUE | 用户名 |
| password | VARCHAR(255) | NOT NULL | 密码（加密存储） |
| email | VARCHAR(100) | UNIQUE | 邮箱 |
| phone | VARCHAR(20) | UNIQUE | 手机号 |
| real_name | VARCHAR(50) | | 真实姓名 |
| status | TINYINT | DEFAULT 1 | 状态：0-禁用，1-启用 |
| created_at | DATETIME | DEFAULT CURRENT_TIMESTAMP | 创建时间 |
| updated_at | DATETIME | DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP | 更新时间 |
| last_login_at | DATETIME | | 最后登录时间 |
| role_id | BIGINT | | 角色ID |

#### 2.1.2 角色表（roles）

| 字段名 | 数据类型 | 约束 | 描述 |
|-------|---------|------|------|
| role_id | BIGINT | PRIMARY KEY, AUTO_INCREMENT | 角色ID |
| role_name | VARCHAR(50) | NOT NULL, UNIQUE | 角色名称 |
| description | VARCHAR(255) | | 角色描述 |
| created_at | DATETIME | DEFAULT CURRENT_TIMESTAMP | 创建时间 |
| updated_at | DATETIME | DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP | 更新时间 |

#### 2.1.3 权限表（permissions）

| 字段名 | 数据类型 | 约束 | 描述 |
|-------|---------|------|------|
| perm_id | BIGINT | PRIMARY KEY, AUTO_INCREMENT | 权限ID |
| perm_name | VARCHAR(50) | NOT NULL, UNIQUE | 权限名称 |
| perm_code | VARCHAR(50) | NOT NULL, UNIQUE | 权限代码 |
| description | VARCHAR(255) | | 权限描述 |
| created_at | DATETIME | DEFAULT CURRENT_TIMESTAMP | 创建时间 |
| updated_at | DATETIME | DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP | 更新时间 |

#### 2.1.4 角色权限关联表（role_permissions）

| 字段名 | 数据类型 | 约束 | 描述 |
|-------|---------|------|------|
| id | BIGINT | PRIMARY KEY, AUTO_INCREMENT | 主键ID |
| role_id | BIGINT | NOT NULL | 角色ID |
| perm_id | BIGINT | NOT NULL | 权限ID |
| created_at | DATETIME | DEFAULT CURRENT_TIMESTAMP | 创建时间 |
| | | UNIQUE KEY (role_id, perm_id) | 确保角色权限唯一 |
| | | FOREIGN KEY (role_id) REFERENCES roles(role_id) ON DELETE CASCADE | 角色外键约束 |
| | | FOREIGN KEY (perm_id) REFERENCES permissions(perm_id) ON DELETE CASCADE | 权限外键约束 |

### 2.2 医疗人员与患者表

#### 2.2.1 患者表（patients）

| 字段名 | 数据类型 | 约束 | 描述 |
|-------|---------|------|------|
| patient_id | BIGINT | PRIMARY KEY, AUTO_INCREMENT | 患者ID |
| user_id | BIGINT | NOT NULL, UNIQUE | 用户ID |
| name | VARCHAR(50) | NOT NULL | 患者姓名 |
| gender | TINYINT | | 性别：0-女，1-男 |
| birthday | DATE | | 出生日期 |
| id_card | VARCHAR(18) | UNIQUE | 身份证号 |
| address | VARCHAR(255) | | 地址 |
| emergency_contact | VARCHAR(50) | | 紧急联系人 |
| emergency_phone | VARCHAR(20) | | 紧急联系电话 |
| created_at | DATETIME | DEFAULT CURRENT_TIMESTAMP | 创建时间 |
| updated_at | DATETIME | DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP | 更新时间 |
| | | FOREIGN KEY (user_id) REFERENCES users(user_id) ON DELETE CASCADE | 用户外键约束 |

#### 2.2.2 医生表（doctors）

| 字段名 | 数据类型 | 约束 | 描述 |
|-------|---------|------|------|
| doctor_id | BIGINT | PRIMARY KEY, AUTO_INCREMENT | 医生ID |
| user_id | BIGINT | NOT NULL, UNIQUE | 用户ID |
| name | VARCHAR(50) | NOT NULL | 医生姓名 |
| department | VARCHAR(50) | NOT NULL | 所属科室 |
| title | VARCHAR(50) | | 职称 |
| specialty | VARCHAR(100) | | 专长 |
| intro | TEXT | | 医生简介 |
| available_status | TINYINT | DEFAULT 1 | 出诊状态：0-不出诊，1-出诊 |
| created_at | DATETIME | DEFAULT CURRENT_TIMESTAMP | 创建时间 |
| updated_at | DATETIME | DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP | 更新时间 |
| | | FOREIGN KEY (user_id) REFERENCES users(user_id) ON DELETE CASCADE | 用户外键约束 |

#### 2.2.3 护士表（nurses）

| 字段名 | 数据类型 | 约束 | 描述 |
|-------|---------|------|------|
| nurse_id | BIGINT | PRIMARY KEY, AUTO_INCREMENT | 护士ID |
| user_id | BIGINT | NOT NULL, UNIQUE | 用户ID |
| name | VARCHAR(50) | NOT NULL | 护士姓名 |
| department | VARCHAR(50) | NOT NULL | 所属科室 |
| title | VARCHAR(50) | | 职称 |
| created_at | DATETIME | DEFAULT CURRENT_TIMESTAMP | 创建时间 |
| updated_at | DATETIME | DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP | 更新时间 |
| | | FOREIGN KEY (user_id) REFERENCES users(user_id) ON DELETE CASCADE | 用户外键约束 |

#### 2.2.4 科室表（departments）

| 字段名 | 数据类型 | 约束 | 描述 |
|-------|---------|------|------|
| dept_id | BIGINT | PRIMARY KEY, AUTO_INCREMENT | 科室ID |
| dept_name | VARCHAR(50) | NOT NULL, UNIQUE | 科室名称 |
| description | VARCHAR(255) | | 科室描述 |
| created_at | DATETIME | DEFAULT CURRENT_TIMESTAMP | 创建时间 |
| updated_at | DATETIME | DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP | 更新时间 |

### 2.3 预约管理相关表

#### 2.3.1 预约表（appointments）

| 字段名 | 数据类型 | 约束 | 描述 |
|-------|---------|------|------|
| appt_id | BIGINT | PRIMARY KEY, AUTO_INCREMENT | 预约ID |
| patient_id | BIGINT | NOT NULL | 患者ID |
| doctor_id | BIGINT | NOT NULL | 医生ID |
| appt_time | DATETIME | NOT NULL | 预约时间 |
| status | TINYINT | DEFAULT 0 | 状态：0-待就诊，1-已就诊，2-已取消，3-已完成 |
| symptom_desc | TEXT | | 症状描述 |
| created_at | DATETIME | DEFAULT CURRENT_TIMESTAMP | 创建时间 |
| updated_at | DATETIME | DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP | 更新时间 |
| | | FOREIGN KEY (patient_id) REFERENCES patients(patient_id) ON DELETE CASCADE | 患者外键约束 |
| | | FOREIGN KEY (doctor_id) REFERENCES doctors(doctor_id) ON DELETE CASCADE | 医生外键约束 |
| | | UNIQUE KEY (doctor_id, appt_time) | 确保同一时间医生只能有一个预约 |

#### 2.3.2 医生排班表（doctor_schedules）

| 字段名 | 数据类型 | 约束 | 描述 |
|-------|---------|------|------|
| schedule_id | BIGINT | PRIMARY KEY, AUTO_INCREMENT | 排班ID |
| doctor_id | BIGINT | NOT NULL | 医生ID |
| work_date | DATE | NOT NULL | 工作日期 |
| start_time | TIME | NOT NULL | 上班时间 |
| end_time | TIME | NOT NULL | 下班时间 |
| max_appointments | INT | DEFAULT 20 | 最大预约数 |
| status | TINYINT | DEFAULT 1 | 状态：0-休息，1-出诊 |
| created_at | DATETIME | DEFAULT CURRENT_TIMESTAMP | 创建时间 |
| updated_at | DATETIME | DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP | 更新时间 |
| | | FOREIGN KEY (doctor_id) REFERENCES doctors(doctor_id) ON DELETE CASCADE | 医生外键约束 |
| | | UNIQUE KEY (doctor_id, work_date) | 确保医生每天只有一个排班 |

### 2.4 病历管理相关表

#### 2.4.1 病历表（medical_records）

| 字段名 | 数据类型 | 约束 | 描述 |
|-------|---------|------|------|
| record_id | BIGINT | PRIMARY KEY, AUTO_INCREMENT | 病历ID |
| patient_id | BIGINT | NOT NULL | 患者ID |
| doctor_id | BIGINT | NOT NULL | 医生ID |
| visit_date | DATETIME | NOT NULL | 就诊日期 |
| diagnosis | TEXT | NOT NULL | 诊断结果 |
| treatment | TEXT | | 治疗方案 |
| prescription_id | BIGINT | | 处方ID |
| created_at | DATETIME | DEFAULT CURRENT_TIMESTAMP | 创建时间 |
| updated_at | DATETIME | DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP | 更新时间 |
| | | FOREIGN KEY (patient_id) REFERENCES patients(patient_id) ON DELETE CASCADE | 患者外键约束 |
| | | FOREIGN KEY (doctor_id) REFERENCES doctors(doctor_id) ON DELETE CASCADE | 医生外键约束 |

#### 2.4.2 病历版本表（medical_record_versions）

| 字段名 | 数据类型 | 约束 | 描述 |
|-------|---------|------|------|
| version_id | BIGINT | PRIMARY KEY, AUTO_INCREMENT | 版本ID |
| record_id | BIGINT | NOT NULL | 病历ID |
| version_number | INT | NOT NULL | 版本号 |
| diagnosis | TEXT | NOT NULL | 诊断结果 |
| treatment | TEXT | | 治疗方案 |
| updated_by | BIGINT | NOT NULL | 更新人ID |
| updated_at | DATETIME | DEFAULT CURRENT_TIMESTAMP | 更新时间 |
| | | FOREIGN KEY (record_id) REFERENCES medical_records(record_id) ON DELETE CASCADE | 病历外键约束 |
| | | FOREIGN KEY (updated_by) REFERENCES users(user_id) ON DELETE CASCADE | 用户外键约束 |

### 2.5 住院管理相关表

#### 2.5.1 住院记录表（hospital_records）

| 字段名 | 数据类型 | 约束 | 描述 |
|-------|---------|------|------|
| hosp_id | BIGINT | PRIMARY KEY, AUTO_INCREMENT | 住院记录ID |
| patient_id | BIGINT | NOT NULL | 患者ID |
| room_id | BIGINT | NOT NULL | 病房ID |
| admit_time | DATETIME | NOT NULL | 入院时间 |
| discharge_time | DATETIME | | 出院时间 |
| admit_diagnosis | TEXT | NOT NULL | 入院诊断 |
| discharge_diagnosis | TEXT | | 出院诊断 |
| status | TINYINT | DEFAULT 0 | 状态：0-住院中，1-已出院 |
| created_at | DATETIME | DEFAULT CURRENT_TIMESTAMP | 创建时间 |
| updated_at | DATETIME | DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP | 更新时间 |
| | | FOREIGN KEY (patient_id) REFERENCES patients(patient_id) ON DELETE CASCADE | 患者外键约束 |

#### 2.5.2 病房表（rooms）

| 字段名 | 数据类型 | 约束 | 描述 |
|-------|---------|------|------|
| room_id | BIGINT | PRIMARY KEY, AUTO_INCREMENT | 病房ID |
| room_number | VARCHAR(20) | NOT NULL, UNIQUE | 病房号 |
| room_type | VARCHAR(50) | NOT NULL | 病房类型 |
| bed_count | INT | DEFAULT 1 | 床位数 |
| available_beds | INT | DEFAULT 1 | 可用床位数 |
| price_per_day | DECIMAL(10,2) | NOT NULL | 每日价格 |
| status | TINYINT | DEFAULT 1 | 状态：0-不可用，1-可用 |
| created_at | DATETIME | DEFAULT CURRENT_TIMESTAMP | 创建时间 |
| updated_at | DATETIME | DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP | 更新时间 |

### 2.6 药品与库存管理相关表

#### 2.6.1 药品表（medicines）

| 字段名 | 数据类型 | 约束 | 描述 |
|-------|---------|------|------|
| medicine_id | BIGINT | PRIMARY KEY, AUTO_INCREMENT | 药品ID |
| medicine_name | VARCHAR(100) | NOT NULL | 药品名称 |
| specification | VARCHAR(100) | NOT NULL | 规格 |
| dosage_form | VARCHAR(50) | NOT NULL | 剂型 |
| manufacturer | VARCHAR(100) | NOT NULL | 生产厂家 |
| unit | VARCHAR(20) | NOT NULL | 单位 |
| price | DECIMAL(10,2) | NOT NULL | 单价 |
| warning_stock | INT | DEFAULT 50 | 预警库存 |
| created_at | DATETIME | DEFAULT CURRENT_TIMESTAMP | 创建时间 |
| updated_at | DATETIME | DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP | 更新时间 |

#### 2.6.2 药品库存表（medicine_stocks）

| 字段名 | 数据类型 | 约束 | 描述 |
|-------|---------|------|------|
| stock_id | BIGINT | PRIMARY KEY, AUTO_INCREMENT | 库存ID |
| medicine_id | BIGINT | NOT NULL, UNIQUE | 药品ID |
| current_stock | INT | DEFAULT 0 | 当前库存 |
| last_stock_in_time | DATETIME | | 最后入库时间 |
| last_stock_out_time | DATETIME | | 最后出库时间 |
| created_at | DATETIME | DEFAULT CURRENT_TIMESTAMP | 创建时间 |
| updated_at | DATETIME | DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP | 更新时间 |
| | | FOREIGN KEY (medicine_id) REFERENCES medicines(medicine_id) ON DELETE CASCADE | 药品外键约束 |

#### 2.6.3 处方表（prescriptions）

| 字段名 | 数据类型 | 约束 | 描述 |
|-------|---------|------|------|
| prescription_id | BIGINT | PRIMARY KEY, AUTO_INCREMENT | 处方ID |
| patient_id | BIGINT | NOT NULL | 患者ID |
| doctor_id | BIGINT | NOT NULL | 医生ID |
| create_time | DATETIME | DEFAULT CURRENT_TIMESTAMP | 创建时间 |
| status | TINYINT | DEFAULT 0 | 状态：0-待审核，1-已审核，2-已发药 |
| total_amount | DECIMAL(10,2) | DEFAULT 0.00 | 总金额 |
| | | FOREIGN KEY (patient_id) REFERENCES patients(patient_id) ON DELETE CASCADE | 患者外键约束 |
| | | FOREIGN KEY (doctor_id) REFERENCES doctors(doctor_id) ON DELETE CASCADE | 医生外键约束 |

#### 2.6.4 处方药品表（prescription_medicines）

| 字段名 | 数据类型 | 约束 | 描述 |
|-------|---------|------|------|
| id | BIGINT | PRIMARY KEY, AUTO_INCREMENT | 主键ID |
| prescription_id | BIGINT | NOT NULL | 处方ID |
| medicine_id | BIGINT | NOT NULL | 药品ID |
| quantity | INT | NOT NULL | 数量 |
| dosage | VARCHAR(100) | NOT NULL | 用法用量 |
| unit_price | DECIMAL(10,2) | NOT NULL | 单价 |
| subtotal | DECIMAL(10,2) | NOT NULL | 小计 |
| | | FOREIGN KEY (prescription_id) REFERENCES prescriptions(prescription_id) ON DELETE CASCADE | 处方外键约束 |
| | | FOREIGN KEY (medicine_id) REFERENCES medicines(medicine_id) ON DELETE CASCADE | 药品外键约束 |

### 2.7 在线支付相关表

#### 2.7.1 费用清单表（fee_bills）

| 字段名 | 数据类型 | 约束 | 描述 |
|-------|---------|------|------|
| bill_id | BIGINT | PRIMARY KEY, AUTO_INCREMENT | 账单ID |
| patient_id | BIGINT | NOT NULL | 患者ID |
| bill_type | TINYINT | NOT NULL | 账单类型：0-门诊，1-住院 |
| total_amount | DECIMAL(10,2) | NOT NULL | 总金额 |
| paid_amount | DECIMAL(10,2) | DEFAULT 0.00 | 已支付金额 |
| status | TINYINT | DEFAULT 0 | 状态：0-未支付，1-已支付，2-已取消 |
| create_time | DATETIME | DEFAULT CURRENT_TIMESTAMP | 创建时间 |
| paid_time | DATETIME | | 支付时间 |
| | | FOREIGN KEY (patient_id) REFERENCES patients(patient_id) ON DELETE CASCADE | 患者外键约束 |

#### 2.7.2 支付记录表（payment_records）

| 字段名 | 数据类型 | 约束 | 描述 |
|-------|---------|------|------|
| payment_id | BIGINT | PRIMARY KEY, AUTO_INCREMENT | 支付记录ID |
| bill_id | BIGINT | NOT NULL | 账单ID |
| payment_method | TINYINT | NOT NULL | 支付方式：0-支付宝，1-微信支付，2-银联 |
| amount | DECIMAL(10,2) | NOT NULL | 支付金额 |
| transaction_no | VARCHAR(100) | NOT NULL, UNIQUE | 交易单号 |
| status | TINYINT | NOT NULL | 支付状态：0-失败，1-成功 |
| create_time | DATETIME | DEFAULT CURRENT_TIMESTAMP | 创建时间 |
| | | FOREIGN KEY (bill_id) REFERENCES fee_bills(bill_id) ON DELETE CASCADE | 账单外键约束 |

### 2.8 检查与检验管理相关表

#### 2.8.1 检查申请表（inspection_applications）

| 字段名 | 数据类型 | 约束 | 描述 |
|-------|---------|------|------|
| appl_id | BIGINT | PRIMARY KEY, AUTO_INCREMENT | 申请ID |
| patient_id | BIGINT | NOT NULL | 患者ID |
| doctor_id | BIGINT | NOT NULL | 医生ID |
| inspection_type | VARCHAR(50) | NOT NULL | 检查类型 |
| inspection_name | VARCHAR(100) | NOT NULL | 检查项目名称 |
| apply_time | DATETIME | DEFAULT CURRENT_TIMESTAMP | 申请时间 |
| scheduled_time | DATETIME | | 预约检查时间 |
| status | TINYINT | DEFAULT 0 | 状态：0-待检查，1-检查中，2-已完成 |
| result_id | BIGINT | | 检查结果ID |
| | | FOREIGN KEY (patient_id) REFERENCES patients(patient_id) ON DELETE CASCADE | 患者外键约束 |
| | | FOREIGN KEY (doctor_id) REFERENCES doctors(doctor_id) ON DELETE CASCADE | 医生外键约束 |

#### 2.8.2 检查结果表（inspection_results）

| 字段名 | 数据类型 | 约束 | 描述 |
|-------|---------|------|------|
| result_id | BIGINT | PRIMARY KEY, AUTO_INCREMENT | 结果ID |
| appl_id | BIGINT | NOT NULL, UNIQUE | 申请ID |
| result_data | TEXT | NOT NULL | 检查结果数据 |
| conclusion | TEXT | | 结论 |
| report_url | VARCHAR(255) | | 报告文件URL |
| doctor_id | BIGINT | NOT NULL | 医生ID |
| create_time | DATETIME | DEFAULT CURRENT_TIMESTAMP | 创建时间 |
| | | FOREIGN KEY (appl_id) REFERENCES inspection_applications(appl_id) ON DELETE CASCADE | 申请外键约束 |
| | | FOREIGN KEY (doctor_id) REFERENCES doctors(doctor_id) ON DELETE CASCADE | 医生外键约束 |

### 2.9 系统安全与日志表

#### 2.9.1 操作日志表（operation_logs）

| 字段名 | 数据类型 | 约束 | 描述 |
|-------|---------|------|------|
| log_id | BIGINT | PRIMARY KEY, AUTO_INCREMENT | 日志ID |
| user_id | BIGINT | NOT NULL | 操作用户ID |
| user_name | VARCHAR(50) | NOT NULL | 操作用户名 |
| operation_type | VARCHAR(50) | NOT NULL | 操作类型 |
| operation_content | TEXT | NOT NULL | 操作内容 |
| ip_address | VARCHAR(50) | | IP地址 |
| user_agent | VARCHAR(255) | | 用户代理 |
| create_time | DATETIME | DEFAULT CURRENT_TIMESTAMP | 操作时间 |
| | | FOREIGN KEY (user_id) REFERENCES users(user_id) ON DELETE CASCADE | 用户外键约束 |

## 3. 基础数据初始化

### 3.1 角色数据

| role_name | description |
|-----------|-------------|
| ADMIN | 系统管理员 |
| DOCTOR | 医生 |
| PATIENT | 患者 |
| NURSE | 护士 |
| PHARMACIST | 药剂师 |

### 3.2 权限数据

| perm_name | perm_code | description |
|-----------|-----------|-------------|
| 用户管理 | user:manage | 管理系统用户 |
| 角色管理 | role:manage | 管理系统角色 |
| 权限管理 | perm:manage | 管理系统权限 |
| 预约管理 | appointment:manage | 管理预约 |
| 病历管理 | record:manage | 管理病历 |
| 药品管理 | medicine:manage | 管理药品 |
| 支付管理 | payment:manage | 管理支付 |
| 检查管理 | inspection:manage | 管理检查 |

### 3.3 管理员用户

| username | password | email | phone | real_name | status | role |
|----------|----------|-------|-------|-----------|--------|------|
| admin | admin123 | admin@medical.com | 13800138000 | 系统管理员 | 1 | ADMIN |

### 3.4 科室数据

| dept_name | description |
|-----------|-------------|
| 内科 | 内科科室 |
| 外科 | 外科科室 |
| 儿科 | 儿科科室 |
| 妇产科 | 妇产科科室 |
| 眼科 | 眼科科室 |
| 耳鼻喉科 | 耳鼻喉科科室 |
| 口腔科 | 口腔科科室 |
| 皮肤科 | 皮肤科科室 |

## 4. 索引设计

| 表名 | 索引名 | 索引字段 | 类型 |
|------|--------|---------|------|
| users | idx_users_role_id | role_id | 普通索引 |
| users | idx_users_status | status | 普通索引 |
| patients | idx_patients_name | name | 普通索引 |
| patients | idx_patients_id_card | id_card | 普通索引 |
| doctors | idx_doctors_department | department | 普通索引 |
| doctors | idx_doctors_available_status | available_status | 普通索引 |
| appointments | idx_appointments_patient_id | patient_id | 普通索引 |
| appointments | idx_appointments_doctor_id | doctor_id | 普通索引 |
| appointments | idx_appointments_appt_time | appt_time | 普通索引 |
| appointments | idx_appointments_status | status | 普通索引 |
| medical_records | idx_medical_records_patient_id | patient_id | 普通索引 |
| medical_records | idx_medical_records_doctor_id | doctor_id | 普通索引 |
| medical_records | idx_medical_records_visit_date | visit_date | 普通索引 |
| medicines | idx_medicines_name | medicine_name | 普通索引 |
| medicines | idx_medicines_manufacturer | manufacturer | 普通索引 |
| medicine_stocks | idx_medicine_stocks_medicine_id | medicine_id | 普通索引 |
| medicine_stocks | idx_medicine_stocks_current_stock | current_stock | 普通索引 |

## 5. 数据库关系图

```
+----------------+     +----------------+     +----------------+     +------------------+
|     users      |     |     roles      |     | permissions    |     | role_permissions |
+----------------+     +----------------+     +----------------+     +------------------+
| user_id (PK)   |<----| role_id (PK)   |<----| perm_id (PK)   |<----| perm_id (FK)     |
| role_id (FK)   |     +----------------+     +----------------+     | role_id (FK)     |
+----------------+                                                  +------------------+
        |
        |
        +----------------------------+
        |                            |
+----------------+          +----------------+          +----------------+          +----------------+     +----------------+     +----------------+     +----------------+
|   patients     |          |    doctors     |          |    nurses      |          |  departments   |     | appointments   |     | doctor_schedules |     | medical_records |
+----------------+          +----------------+          +----------------+          +----------------+     +----------------+     +----------------+     +----------------+
| user_id (FK)   |<---------| user_id (FK)   |<---------| user_id (FK)   |          | dept_id (PK)   |     | patient_id (FK)|     | doctor_id (FK)  |     | patient_id (FK)|     +------------------+
| patient_id (PK)|          | doctor_id (PK) |          | nurse_id (PK)  |          | dept_name      |     | doctor_id (FK) |     | work_date      |     | doctor_id (FK) |     | medical_record_versions |
|                |          | department     |<---------| department     |          |                |     | appt_time      |     | status         |     | visit_date     |     +------------------+
+----------------+          +----------------+          +----------------+          +----------------+     +----------------+     +----------------+     | record_id (PK) |     | version_id (PK)  |
        |                                                                                                  | prescription_id |     |                 |     | record_id (FK)  |
        |                                                                                                  +----------------+     +----------------+     +------------------+
        |                                                                                                                  |
        |                                                                                                                  |
        |                                                                                                                  |
+----------------+                                                                                   +----------------+     |
| hospital_records|                                                                                   |  prescriptions |     |
+----------------+                                                                                   +----------------+     |
| patient_id (FK)|                                                                                   | patient_id (FK)|<----+     +---------------------+
| room_id (FK)   |<---+                                                                              | doctor_id (FK) |     |     | prescription_medicines |
+----------------+    |                                                                              | status         |     |     +---------------------+
                      |                                                                              | total_amount   |     |     | prescription_id (FK)  |
+----------------+    |                                                                              +----------------+     |     | medicine_id (FK)      |
|     rooms      |    |                                                                                            |     |     +---------------------+
+----------------+    |                                                                                            |     |
| room_id (PK)   |----+                                                                                            |     |     +----------------+
| room_number    |                                                                                                  |     |     |    medicines   |
+----------------+                                                                                                  |     |     +----------------+
                                                                                                                   |     |     | medicine_id (PK)|<--+     +------------------+
+----------------+                                                                                   +----------------+     |     | medicine_name  |     |     | medicine_stocks |
|   fee_bills    |                                                                                   | inspection_applications |     | specification  |     |     +------------------+
+----------------+                                                                                   +----------------+     |     | price          |     |     | medicine_id (FK) |
| patient_id (FK)|                                                                                   | patient_id (FK)|     |     +----------------+     |     | current_stock   |
| bill_type      |                                                                                   | doctor_id (FK) |     |                               |     +------------------+
| status         |                                                                                   | status         |     |                               |
+----------------+                                                                                   | result_id (FK) |     |     +----------------+     +----------------+
        |                                                                                            +----------------+     |     | inspection_results |     |  payment_records |
        |                                                                                                      |     |     +----------------+     +----------------+
        |                                                                                                      |     |     | result_id (PK)  |     | bill_id (FK)    |
        v                                                                                                      |     |     | appl_id (FK)    |     | payment_method  |
+----------------+                                                                                             |     |     | doctor_id (FK)  |     | amount          |
| payment_records|                                                                                             |     +----------------+     | transaction_no |
+----------------+                                                                                             |                           | status          |
| bill_id (FK)   |                                                                                             |                           +----------------+
| payment_method |                                                                                             |
| amount         |                                                                                             |
| transaction_no |                                                                                             |
| status         |                                                                                             |
+----------------+                                                                                             |
                                                                                                              |
                                                                                                              |
+----------------+                                                                                             |
| operation_logs |                                                                                             |
+----------------+                                                                                             |
| user_id (FK)   |                                                                                             |
| operation_type |                                                                                             |
| operation_content |                                                                                          |
+----------------+                                                                                             |
                                                                                                              |
                                                                                                              |
                                                                                                              v
                                                                                                       +----------------+
                                                                                                       | 检查结果表      |
                                                                                                       +----------------+
```

## 6. 设计说明

1. **用户管理**：采用RBAC（基于角色的访问控制）模型，实现了用户、角色、权限的分离管理。

2. **医疗人员与患者**：通过用户表扩展出患者、医生、护士等角色，便于统一管理和权限控制。

3. **预约管理**：实现了医生排班和患者预约功能，通过唯一索引确保医生同一时间只能有一个预约。

4. **病历管理**：支持病历的版本控制，记录每次修改的历史记录。

5. **住院管理**：实现了病房管理和住院记录跟踪功能。

6. **药品与库存**：实现了药品信息管理、库存监控和处方管理功能。

7. **在线支付**：支持多种支付方式，记录支付历史和账单信息。

8. **检查与检验**：实现了检查申请和结果管理功能。

9. **系统安全**：记录操作日志，便于审计和追踪用户操作。

## 7. 使用说明

1. 运行`medical_system_init.sql`脚本可以创建完整的数据库结构和初始化数据。
2. 管理员账号：admin，密码：admin123
3. 根据需要调整数据库参数和索引设计。
4. 在应用程序中配置数据库连接信息。

## 8. 扩展建议

1. 根据实际需求添加更多的业务表和字段。
2. 优化索引设计，提高查询性能。
3. 实现数据备份和恢复策略。
4. 添加数据统计和报表功能。
5. 实现数据加密和访问控制机制。